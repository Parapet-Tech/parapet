# L1: Lightweight Classifier

L1 is a compiled-in first-pass classifier for prompt injection style text in untrusted messages.

It uses character n-gram weights generated offline and shipped in the binary for low-latency inference.

## Config

```yaml
layers:
  L1:
    mode: block      # shadow | block
    threshold: 0.0
```

## What L1 scans

L1 scans message content when `message.trust != trusted`.

1. Trusted messages are skipped.
2. Empty messages are skipped.
3. L1 uses message-level trust, not per-span trust.

## How scoring works

1. Raw score: linear SVM margin from char n-gram features.
2. Calibrated score: sigmoid-mapped probability in `[0.0, 1.0]` for signal combination.
3. Verdict: first message with `raw_score >= threshold` is a block candidate.
4. L1 still scores all untrusted messages for observability and downstream signal combination.

## Modes

1. `block`: block request when verdict is block.
2. `shadow`: log detection but allow request.

## Eval snapshot (v3)

From `implement/evals/v3/l1.md` (2026-02-14, threshold `0.0`):

1. Precision: `98.2%`
2. Recall: `98.9%`
3. F1: `98.6%`

L1 is fast and effective for common injection patterns, but it is not the only defense layer.
